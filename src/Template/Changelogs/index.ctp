<style>
.side-nav li a:not(.button) {
	display:inline;
}


.changelogrow
{
<<<<<<< HEAD
/*changelog title row*/

/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#b0d4e3+0,88bacf+100;Grey+3D+%233 */
background: #b0d4e3; /* Old browsers */
background: -moz-linear-gradient(top,  #b0d4e3 0%, #88bacf 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top,  #b0d4e3 0%,#88bacf 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom,  #b0d4e3 0%,#88bacf 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#b0d4e3', endColorstr='#88bacf',GradientType=0 ); /* IE6-9 */


}


/*the title font link*/
.changelogrow a
{
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#ffd65e+0,febf04+100;Yellow+3D+%232 */
background: #ffd65e; /* Old browsers */
background: -moz-linear-gradient(top,  #ffd65e 0%, #febf04 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top,  #ffd65e 0%,#febf04 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom,  #ffd65e 0%,#febf04 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffd65e', endColorstr='#febf04',GradientType=0 ); /* IE6-9 */

}



=======
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#f7fbfc+0,d9edf2+40,add9e4+100;Blue+3D+%231 */
background: #f7fbfc; /* Old browsers */
background: -moz-linear-gradient(top,  #f7fbfc 0%, #d9edf2 40%, #add9e4 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top,  #f7fbfc 0%,#d9edf2 40%,#add9e4 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom,  #f7fbfc 0%,#d9edf2 40%,#add9e4 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f7fbfc', endColorstr='#add9e4',GradientType=0 ); /* IE6-9 */

}

/*table header*/
th {

}

/*
.changelogtitle{
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#fceabb+0,fccd4d+50,f8b500+51,fbdf93+100;Orange+3D+%235 */
background: #fceabb; /* Old browsers */
background: -moz-linear-gradient(top,  #fceabb 0%, #fccd4d 50%, #f8b500 51%, #fbdf93 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top,  #fceabb 0%,#fccd4d 50%,#f8b500 51%,#fbdf93 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom,  #fceabb 0%,#fccd4d 50%,#f8b500 51%,#fbdf93 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fceabb', endColorstr='#fbdf93',GradientType=0 ); /* IE6-9 */
}
*/


/*
.changelogdesc{
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#e2e2e2+0,dbdbdb+50,d1d1d1+51,fefefe+100;Grey+Gloss+%231 */
background: #e2e2e2; /* Old browsers */
background: -moz-linear-gradient(top,  #e2e2e2 0%, #dbdbdb 50%, #d1d1d1 51%, #fefefe 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top,  #e2e2e2 0%,#dbdbdb 50%,#d1d1d1 51%,#fefefe 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom,  #e2e2e2 0%,#dbdbdb 50%,#d1d1d1 51%,#fefefe 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#e2e2e2', endColorstr='#fefefe',GradientType=0 ); /* IE6-9 */
}
*/



#changelogs th {
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#eaefb5+0,e1e9a0+100;Wax+Flat */
background: #eaefb5; /* Old browsers */
background: -moz-linear-gradient(top,  #eaefb5 0%, #e1e9a0 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top,  #eaefb5 0%,#e1e9a0 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom,  #eaefb5 0%,#e1e9a0 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#eaefb5', endColorstr='#e1e9a0',GradientType=0 ); /* IE6-9 */
}




#logtitle.tr
{
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#e9f6fd+0,d3eefb+100;Blue+3D+%233 */
background: #e9f6fd; /* Old browsers */
background: -moz-linear-gradient(top,  #e9f6fd 0%, #d3eefb 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top,  #e9f6fd 0%,#d3eefb 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom,  #e9f6fd 0%,#d3eefb 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#e9f6fd', endColorstr='#d3eefb',GradientType=0 ); /* IE6-9 */


}



#changelogs {
    font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
    border-collapse: collapse;

}

#changelogs td, #changelogs th {
    border: 1px solid #ddd;
    padding: 8px;
}

#changelogs tr:nth-child(even){background-color: #f2f2f2;}

#changelogs tr:hover {background-color: #ddd;}



</style>

<?php   
	use Cake\Core\Configure;	
	
    /**
        read the text values from the config file.
    **/
	$priority=Configure::read('priority');
	$status=Configure::read('status');		
	
	//load css
	echo $this->Html->css('Gerrymcdonnell/Changelog.style');
?>

<nav class="large-2 medium-3 small-4 columns" id="actions-sidebar">
    <ul class="side-nav">
        <li class="heading"><?= __('Actions:') ?></li>
        <li>
		
		<?php 
			echo $this->Html->link(__('New'), ['controller'=>'changelogs','action' => 'add']);
		?>
		</li>
		
        <li><?= $this->Html->link(__('New Category'), ['controller'=>'changelog-categories','action' => 'add']) ?></li>
		
		<hr>
		<li><?= $this->Html->link(__('Sticky Logs'), ['action' => 'stickynotes']) ?></li> 
		<li><?= $this->Html->link(__('All Changelog'), ['action' => 'index']) ?></li>   
		<hr>
		 
        <li><?= $this->Html->link(__('Category List'), ['controller'=>'changelog-categories','action' => 'index']) ?></li>
		
		<hr>
		<li><?= $this->Html->link(__('Search'), ['action' => 'search']) ?></li>   
        
        <hr>Date
        <li><?= $this->Html->link(__('Latest Open'), ['action' => 'getlatest',1]) ?></li>
        <li><?= $this->Html->link(__('Latest Logs'), ['action' => 'getlatest',0]) ?></li>
		<li><?= $this->Html->link(__('Latest Modified'), ['action'=>'getByModified']) ?></li>
        


            


        <hr>Status
        <li><?= $this->Html->link(__('Open'), ['action' => 'getstatus',0]) ?></li>
        <li><?= $this->Html->link(__('Closed'), ['action' => 'getstatus',1]) ?></li>

        <hr>Priority
        <li><?= $this->Html->link(__('Low'), ['action' => 'getpriority',0]) ?></li>
        <li><?= $this->Html->link(__('Med'), ['action' => 'getpriority',1]) ?></li>
        <li><?= $this->Html->link(__('High'), ['action' => 'getpriority',2]) ?></li>
		<li><?= $this->Html->link(__('Critical'), ['action' => 'getpriority',3]) ?></li>

        <hr>Categories         
        <?php
            //Changelogscategories            
            
            foreach ($Changelogscategories as $catagory)
            {                
                echo '<li>';
                echo $this->Html->link(__($catagory['title']), ['action' => 'getcategory',$catagory['id']]);
                echo '</li>';
            }
        ?>

        
        <?php     
			/*
			//Ajax - In Development
            echo '<li>';
            echo $this->Html->link('test clear','javascript:cleartable()');
            echo '</li>';

            echo '<li>';
            echo $this->Html->link('test all','javascript:ajax_getall()');
            echo '</li>';
			*/
        ?>



    </ul>
</nav>
<div class="changelogs index large-10 medium-9 small-8 columns content">


    <h3>
    <?php 
        if (isset($subtitle)){
            echo 'Changelogs: '.$subtitle; 
        }
        else{
            echo 'Changelogs'; 
        }        
    ?>
    </h3>
	
	
    <table cellpadding="0" cellspacing="0" id= "changelogs">
        <thead>
            <tr>
                
                <th><?= $this->Paginator->sort('title') ?></th>

                <th><?= $this->Paginator->sort('category') ?></th>   

				
				<?php
					//user name
					/*
					echo '<th>';
					echo $this->Paginator->sort('user_id');
					echo '</th>';
					*/
				?>
				
                <th><?= $this->Paginator->sort('priority') ?></th>
                <th><?= $this->Paginator->sort('status') ?></th>

                <th><?= $this->Paginator->sort('created') ?></th>
				<th><?= $this->Paginator->sort('modified') ?></th>
                <th class="actions"><?= __('Actions') ?></th>
            </tr>
        </thead>
        <tbody id="changelogsbody">

        <?php $i=0; ?>
            <?php foreach ($changelogs as $changelog): ?>
            
            <?php
				//load table row element
				//echo $this->element('changelogs/tablerow');				
				//echo $this->Html->tableCells([['Jul 7th, 2007', 'Best Brownies', 'Yes']]);
			?>
			
			
			<?php
				$i++;
				echo '<tr class="changelogrow" id="changelogrow_'.$i.'">';
			?>

			<td colspan="7" class="changelogtitle" id="logtitle_<?= $changelog->id ?>">
				<?php 
					if($changelog->status==1){						
						//item is closed
						echo $this->Html->link($changelog->title,['action'=>'edit',$changelog->id],['class'=>'changelogstrike']);						
					}
					else{
						echo $this->Html->link($changelog->title,['action'=>'edit',$changelog->id]);
					}
				?>
			</td>
			</tr>
			


			<tr>
			<td>..</td>
			<td>
			<?php   
				//debug($changelog);
				echo $this->Html->link($changelog->changelog_category->title,['action'=>'getcategory',$changelog->changelog_category->id]);
			?>
			</td>

			
			<?php
				//Username
				//echo '<td>';
				//echo $changelog->has('user') ? $this->Html->link($changelog->user->username, ['controller' => 'Users', 'action' => 'view', $changelog->user->id]) : '';
				//echo $changelog->user->username;
				//echo '</td>';
			?>
			
	
			
			<td>
			<?php 
				/**
					colour coded labels for thge priority fields
				**/
				//load the zurb helper from Zurb plugin
				$this->loadHelper('Gerrymcdonnell/Changelog.Zurb');  

				if($changelog->priority==0){
					$this->Zurb->printLabel('secondary',$priority[$changelog->priority]);
				}
				else if($changelog->priority==1){
					$this->Zurb->printLabel('regular',$priority[$changelog->priority]);
				}
				else if($changelog->priority==2){
					$this->Zurb->printLabel('warning',$priority[$changelog->priority]);
				}
				else if($changelog->priority==3){
					$this->Zurb->printLabel('alert',$priority[$changelog->priority]);
				}
				else{
					echo $priority[$changelog->priority]; 
				}
			?>
			</td>

			

			<td id="status_<?=$changelog->id ?>" class="status">
			<?php 
				//colour coded priority status
				if($changelog->status==0){
					$this->Zurb->printLabel('success',$status[$changelog->status]);
				}
				else if($changelog->status==1){
					$this->Zurb->printLabel('regular',$status[$changelog->status]);
				}
				else{
					echo $status[$changelog->status]; 
				}			   
			?>
			</td>


			<td>
			<?php
				//created
				$customformat = $changelog->created->i18nFormat('dd-MMMM-YYYY HH:mm');
				echo $customformat;
			?>
			</td>
			
			
			<td>
			<?php
				//modified
				if(is_null($changelog->modified)==false)
					$customformat = $changelog->modified->i18nFormat('dd-MMMM-YYYY HH:mm');
				else
					$customformat="n/a";
					
				echo $customformat;
			?>
			</td>



			<td class="actions">
				<?php

					//echo $this->Html->link(__('ajax'), 'javascript:addrow('.$i.')');
					
					echo $this->Html->link(__(' View '), ['action' => 'view', $changelog->id]);
					echo $this->Html->link(__(' Edit '), ['action' => 'edit', $changelog->id]);
					echo $this->Form->postLink(__(' Delete'), ['action' => 'delete', $changelog->id], ['confirm' => __('Are you sure you want to delete # {0}?', $changelog->id)]) 

				?>
			</td>
			</tr>
		
			
			<!--desc under the title -->
			<?php
				

				//add desc summary under the title
				echo '<tr><td class="changelogdesc" colspan=7>';
					echo '<b>description:</b><p>';
					//truncate text
					//echo '<blockquote>';
					
					//if desc is null prnt N/A
					if($changelog->description==null){
						echo 'N/A';							
					}					
					
					//truncate or not
					if(Configure::read('show_description_truncate')==true)
						echo $this->Text->truncate($changelog->description, 100,['ellipsis' => '...','exact' => false]);
					else					
						echo $this->Text->autoParagraph($this->Text->autoLink($changelog->description));
					
					//echo '</blockquote>';
				echo '</td></tr>';
				

				
				//URL links
				echo '<tr><td class="changelogdesc" colspan=7>';
				echo 'Related URL: ';
				if($changelog->url==null){
						echo 'n/a';
				}
				else{
					$link=$this->Text->truncate($changelog->url,30,array('ellipsis' => '..','exact' => false));
					echo $this->Html->link($changelog->url); 
				}
				echo '</td></tr>';
				
				//blank row
				echo '<tr><td colspan=7>';
				echo '</td></tr>';
				
			?>
			
			
            <?php endforeach; ?>
        </tbody>
    </table>
    <div class="paginator">
        <ul class="pagination">
            <?= $this->Paginator->prev('< ' . __('previous')) ?>
            <?= $this->Paginator->numbers() ?>
            <?= $this->Paginator->next(__('next') . ' >') ?>
        </ul>
        <p><?= $this->Paginator->counter() ?></p>
    </div>
</div>

<hr>


<center>
<div class="panel">
<?php
	//version info
	echo '<p>';
    echo Configure::read('plugin_name').'_'.Configure::read('ver');
	
	/*
	echo '<p>';
	echo $this->Html->link(Configure::read('github'),Configure::read('github'));
	echo '<p>';
	echo $this->Html->link(Configure::read('website'));
	echo '<p>';
	*/
?>


</div>
</center>

<script>

/**
flip the status
**/
$('.status').on('dblclick', function(e) {
	id=$(this).attr('id');
	
	tmp=id.split('_');
	id=tmp[1];	
	
	s=$(this).text().trim();
	
	console.log(s);
	
	if(s=="Open"){		
		status=1;
		$(this).attr('class', '');
		$(this).attr('class', 'label');
		$(this).text('Closed');
		//this is the closed/open label, need to go up an element
		//$(this).attr('class', 'changelogstrike');
		
		$('#logtitle_'+id).attr('class', 'changelogstrike');
	}
	else{
		status=0;
		$(this).attr('class', '');
		$(this).attr('class', 'success label');
		$(this).text('Open');
		//$(this).attr('class', 'changelog');
		
		$('#logtitle_'+id).attr('class', 'changelog');
	}
	
	ajaxeditstatus(id,status);
	
	//$(this).attr('class', 'label');
		
});


function ajaxeditstatus(changelog_id,status){	

	var mydata=new Object();
	mydata.changelog_id=changelog_id;
	mydata.status=status;

		jQuery.ajax({
			type:'POST',
			async: true,
			cache: false,
			data: mydata,
			url: 'changelogs/ajaxedit/'+changelog_id,
			success: function(response) {					
				//success
				console.log(response);                
			},
			error: function(response) {					
				console.log(response);
			}
		});
}









function addrow(rowid)
{
    $('#changelogs').append('<tr> <td>title</td> <td>cat</td> <td>user</td> <td>url</td> <td>prioi</td> <td>status </td>  <td>created</td> </tr>');
}

function addnewlogrow(rowid,changelog)
{
    $('#changelogs').append('<tr> <td>'+changelog.title+'</td> <td>'+changelog.changelogscategory.title+'</td> <td>'+changelog.user_id+'</td> <td>'+changelog.url+'</td> <td>'+changelog.priority+'</td> <td>'+changelog.status+'</td>  <td>'+changelog.created+'</td> </tr>');
}


//ajax load all changelogs
function ajax_getall()
{
    var i=0;
     
     jQuery.ajax({
        type:'POST',
        async: true,
        cache: false,
        url: 'changelogs/index.json',
        success: function(response) {          
           //loop through results
           $.each(response.changelogs, function(key, value) {
                console.log("title:" + value.title);  
                i++;   

				//add to table
                addnewlogrow(i,value);          
            });
           console.log("found "+i + " log");          
        },
        error: function(response) {
            console.log("error");
        },
    });
}



function cleartable()
{
     $('#changelogsbody').empty();
}

</script>